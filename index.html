<!doctype html>
<html lang=en>
  <head>
    <title>Bookmarklets</title>
    <style>
      a {
        text-decoration: none;
      }

      a[href^=javascript] {
        border: 2px solid #0085f230;
        border-radius: 4px;
        font-family: sans-serif;
        padding: 4px;
      }

      body {
        margin: 1rem;
      }

      h1, h2 {
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <header>
      <h1 id="h1-bookmarklets">Bookmarklets</h1>

      <p>Copyright 2023 Yawar Amin</p>

      <p>This file is part of bookmarklets.</p>

      <p>bookmarklets is free software: you can redistribute it and/or modify it
      under the terms of the GNU General Public License as published by the Free
      Software Foundation, either version 3 of the License, or (at your option)
      any later version.</p>

      <p>bookmarklets is distributed in the hope that it will be useful, but
      WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
      or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
      for more details.</p>

      <p>You should have received a copy of the GNU General Public License along
      with bookmarklets. If not, see <a
      href="https://www.gnu.org/licenses/">https://www.gnu.org/licenses/</a>.</p>

      <p>‚ÑπÔ∏è  The bookmarklets' source code in this page are in a <a
      href="https://www.toptal.com/developers/javascript-minifier">minified</a>
      form. To get the original code, go to the <a
      href="https://github.com/yawaramin/bookmarklets">GitHub repo</a>.</p>

      <p><b>To install</b> each bookmarklet, simply drag and drop its link to
      your browser's Bookmarks bar.</p>
    </header>
    <main>
      <h2 id="h2-anchors-toggle">Anchors toggle</h2>

      <p>Show or hide all anchors (elements with <code>id</code> or
      <code>name</code> attributes) on the page.</p>

      <p><a href='javascript:(()=>{let e="data-anchor",t=document.querySelectorAll(`[${e}]`);if(0==t.length){let r="github-yawaramin-ext-link",a=`${r}-id`,i=document.getElementById(a)||document.createElement("style");i.id=a,i.innerText=`.${r} {
  background-color:#e9e9e9;
  border-radius:10px;
  margin-left:4px;
  padding:4px;
  font-family: sans-serif;
  font-size:x-small;
}`,document.head.appendChild(i),document.querySelectorAll("[id], [name]").forEach(t=>{if(t.id!=a){let i=document.createElement("a"),l=t.getAttribute("id")||t.getAttribute("name");i.setAttribute("href",`#${l}`),i.setAttribute(e,"true"),i.className=r,i.innerText=`üîó ${l}`,t.parentNode?.insertBefore(i,t)}})}else t.forEach(e=>e.parentNode.removeChild(e))})()'>anchors toggle</a></p>

      <h2 id="h2-bitbucket-comments-min">BitBucket comments minimize</h2>

      <p>In BitBucket PRs, some workflows (or long-winded reviews) can pile up a
      lot of comments. Unfortunately, you have to scroll past all the comments
      to get to the diff. It's much easier to do that if all the comments are
      automatically collapsed and can be expanded with a click. This collapses
      (minimizes) the PR comments.</p>

      <p><a href='javascript:document.querySelectorAll("button > span[aria-label=collapse]").forEach(l=>l.click())'>bitbucket comments min</a></p>

      <h2 id="h2-bitbucket-merge">BitBucket merge</h2>

      <p>In BitBucket PRs, when you have the 'squash merge' feature enabled
      (which you really should), the default commit message is formatted really
      badly:</p>

      <pre>Merged in your-branch (pull request #nnn)

Real first line

Other lines</pre>

      <p>So when you do <code>git log --oneline</code>, the one-line summary
      logs are full of inscrutable 'Merged in...' messages which don't describe
      the actual commits themselves. This is a long-standing issue known to
      BitBucket: <a
      href="https://jira.atlassian.com/browse/BCLOUD-19402">https://jira.atlassian.com/browse/BCLOUD-19402</a>.</p>

      <p>This bookmarklet fixes the message to look like this:</p>

      <pre>Real first line (PR #nnn)

Other lines</pre>

      <p>Then it copies the fixed text to the clipboard and asks you to paste it
      into the commit message textbox. Unfortunately this extra step seems
      unavoidable because of the way the BitBucket textbox is designed. But it
      works fairly well. To use it, you click on the bookmarklet instead of
      clicking on the PR's 'Merge' button. Then you do a paste operation, and
      click the dialog box's 'Merge' button.</p>

      <p><a href='javascript:(async()=>{let e="#pull-request-details > header > div > div > div.sc-gqjmRU.dlKxWb > div > div.css-1yuhvjn.e1q0qh516 > div > div > div > div.css-1oy5iav > div > button, #pull-request-details > div.css-1vm82r5.e9jxcmf0 > div > div.css-1991von.e1vsqsia0 > div > div > div.css-1oy5iav > button.css-1ywzcwn",t=document.querySelector(e);if(null!=t&&t instanceof HTMLButtonElement){window.scrollBy(0,1),t.click();let s=document.getElementById("merge-dialog-commit-message-textfield");if(null!=s&&s instanceof HTMLTextAreaElement){let i=/^Merged[^(]+\(pull request ([^)]+)\)\n\n([^\n]*)\n\n([^]*)/.exec(s.value);if(null!=i){let d=`${i[2]} (PR ${i[1]})\n\n${i[3]}`;await navigator.clipboard.writeText(d),s.select();let l=document.createTextNode("‚úã remember to paste!");s.addEventListener("paste",e=>l.data="‚úÖ ready to merge!"),s.parentNode?.insertBefore(l,s)}else console.warn("Default merge message in unexpected format")}else console.warn("Merge commit message text box not found")}else console.warn(`Merge button not found, probably need to update its selector: ${e}`)})()'>bitbucket merge</a></p>

      <h2 id="h2-ext-links">External links</h2>

      <p>Show external links on the page visually. Suffixes the text of the
      hyperlink with its hostname.</p>

      <p><a href='javascript:(()=>{let e=window.location.host,t="github-yawaramin-ext-link",a=`${t}-id`,l=document.getElementById(a)||document.createElement("style");l.id=a,l.innerText=`.${t} {
  background-color:#e9e9e9;
  border-radius:10px;
  margin-left:4px;
  padding:4px;
  font-family: sans-serif;
  font-size:x-small;
}`,document.head.appendChild(l),document.querySelectorAll("a").forEach(a=>{if(a instanceof HTMLAnchorElement){let l=a.getAttribute("href");if(null!=l&&l.startsWith("http")){let n=new URL(l).host;if(e!=n){let i=document.createElement("span");i.className=t,i.innerText=n,a.appendChild(i)}}}})})()'>ext links</a></p>

      <h2 id="h2-home-page">Home page</h2>

      <p>Go to this site's home page.</p>

      <p><a href="javascript:window.location.href=window.location.origin">home page</a></p>

      <h2 id="h2-odoc-idx">Odoc index</h2>

      <p>If you are viewing an odoc-generated OCaml documentation module page
      like <a
      href="https://yawaramin.github.io/dream-html/dream-html/Dream_html/index.html">this</a>,
      this bookmarklet will generate an alphabetically-sorted index of the
      contents of the module, and inject it into the left sidebar.</p>

      <p><a href='javascript:(()=>{let e=document.querySelector("nav.odoc-toc");if(null==e){console.warn("Could not find odoc TOC");return}let t=(t,l,r)=>{if(0==l.length)return;l.sort();let n=document.createElement("h3"),s=document.createElement("ul");n.innerText=t,e.appendChild(n),e.appendChild(s),l.forEach(e=>{let t=document.createElement("li"),l=document.createElement("a");l.setAttribute("href","#"+e),l.innerText=e.substring(r),t.appendChild(l),s.appendChild(t)})},l=[],r=[],n=[],s=[];document.querySelectorAll("div[id]").forEach(e=>{let t=e.id;t.startsWith("val-")?l.push(t):t.startsWith("type-")?r.push(t):t.startsWith("module-")?n.push(t):t.startsWith("module-type-")&&s.push(t)}),t("Module Types",s,12),t("Modules",n,7),t("Types",r,5),t("Values",l,4)})()'>odoc idx</a></p>

      <h2 id="h2-paste-enable">Paste enable</h2>

      <p>Some very annoying websites disable the paste functionality on some of
      their inputs by hijacking the paste event. This re-enables paste
      functionality.</p>

      <p><a
      href='javascript:document.addEventListener("paste",e=>e.stopImmediatePropagation(),!0);'>paste
      enable</a></p>

      <h2 id="h2-scroll-toggle">Scroll toggle</h2>

      <p>Scroll to the top or bottom of the page.</p>

      <p><a
      href="javascript:window.scrollTo(0,window.scrollY==0?document.body.scrollHeight:0)">scroll
      toggle</a></p>

      <h2 id="h2-sticky-kill">Sticky kill</h2>

      <p>Kill sticky elements that hide parts of the page beneath them.</p>

      <p>‚ÑπÔ∏è  Go to <a
      href="https://github.com/t-mart/kill-sticky">https://github.com/t-mart/kill-sticky</a>
      to install this bookmarklet.</p>

      <h2 id="h2-url-decr">URL decrement</h2>

      <p>Decrement the last number in the URL and navigate to the resulting
      page.</p>

      <p><a href='javascript:(()=>{let l=/^([^\d.]*)(\d+)([/.][^/.]*)?$/.exec(window.location.pathname);if(null!=l){let a=l[3];window.location.pathname=l[1]+(parseInt(l[2])-1)+(null==a?"":a)}})();'>url decr</a></p>

      <h2 id="h2-url-incr">URL increment</h2>

      <p>Increment the last number in the URL and navigate to the resulting
      page.</p>

      <p><a href='javascript:(()=>{let l=/^([^\d.]*)(\d+)([/.][^/.]*)?$/.exec(window.location.pathname);if(null!=l){let a=l[3];window.location.pathname=l[1]+(parseInt(l[2])+1)+(null==a?"":a)}})();'>url incr</a></p>

      <h2 id="h2-whois">Whois lookup</h2>

      <p>Do a WHOIS lookup of the current domain.</p>

      <p><a
      href="javascript:window.open(`https://www.whois.com/whois/${window.location.host}`)">whois</a></p>

    </main>
  </body>
</html>

